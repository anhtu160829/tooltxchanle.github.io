<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MD5 ‚Üí Ch·∫µn / L·∫ª AI</title>

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial;
    background: linear-gradient(180deg, #020617, #0f172a);
    color: #e5e7eb;
    min-height: 100vh;
    display: flex;
    justify-content: center;
}

.app {
    width: 100%;
    max-width: 420px;
    padding: 15px;
}

.card {
    background: #020617;
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,.4);
}

h2 { text-align: center; margin: 0 0 15px; }

input {
    width: 100%;
    padding: 14px;
    font-size: 16px;
    border-radius: 12px;
    border: none;
    background: #0f172a;
    color: #e5e7eb;
}

.btn-row {
    display: flex;
    gap: 10px;
    margin-top: 10px;
}

button {
    flex: 1;
    padding: 14px;
    font-size: 16px;
    font-weight: bold;
    border-radius: 14px;
    border: none;
    cursor: pointer;
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
    color: white;
}

.result, .history {
    margin-top: 15px;
    padding: 14px;
    border-radius: 14px;
    background: #0f172a;
}

.highlight {
    font-size: 22px;
    font-weight: bold;
    text-align: center;
    margin: 10px 0;
}

.small { font-size: 13px; opacity: .85; }

.history h4 {
    margin: 0 0 8px;
    font-size: 15px;
}

.history-item {
    font-size: 13px;
    border-bottom: 1px dashed #334155;
    padding: 4px 0;
}
</style>
</head>

<body>
<div class="app">
<div class="card">

<h2>üîê MD5 ‚Üí CH·∫¥N / L·∫∫ (AI)</h2>

<input id="md5" placeholder="Nh·∫≠p ho·∫∑c d√°n MD5 (32 hex)">

<div class="btn-row">
    <button onclick="pasteMD5()">üìã D√ÅN</button>
    <button onclick="analyze()">PH√ÇN T√çCH</button>
</div>

<div id="result" class="result"></div>

<div class="history">
    <h4>üìú L·ªãch s·ª≠</h4>
    <div id="historyList"></div>
</div>

</div>
</div>

<script>
/* ========= ENTROPY ========= */
function hexEntropy(hex) {
    const freq = {};
    for (let c of hex) freq[c] = (freq[c] || 0) + 1;
    let e = 0;
    for (let k in freq) {
        let p = freq[k] / hex.length;
        e -= p * Math.log2(p);
    }
    return e;
}

/* ========= DEEP SCORE ========= */
function deepScore(md5) {
    const ent = hexEntropy(md5);
    const freq = {};
    for (let c of md5) freq[c] = (freq[c] || 0) + 1;
    let rep = Object.values(freq).filter(v => v > 2).length;
    let sym = 0;
    for (let i = 0; i < 16; i++) if (md5[i] === md5[i+16]) sym++;
    let score = ent*10 + (50-ent*20) + (sym/16)*30 - (rep/Object.keys(freq).length)*15;
    return Math.max(0, Math.min(100, score));
}

/* ========= RNG ========= */
function seededRandom(seed) {
    let x = Math.sin(seed) * 10000;
    return x - Math.floor(x);
}

/* ========= V·ªä L√ìT ========= */
function pickLot(md5, isLe) {
    const pool = isLe ? [1,3] : [0,2,4];
    let s = parseInt(md5.slice(8,16),16);
    let a = pool[Math.floor(seededRandom(s)*pool.length)];
    let b = pool[Math.floor(seededRandom(s+1)*pool.length)];
    if (a===b) b = pool[(pool.indexOf(a)+1)%pool.length];
    return [a,b].sort((x,y)=>x-y);
}

/* ========= L·ªúI KHUY√äN ========= */
function advice(conf) {
    if (conf > 75) return "üî• K√®o m·∫°nh ‚Äì c√≥ th·ªÉ theo";
    if (conf > 55) return "‚ö†Ô∏è K√®o trung b√¨nh ‚Äì c√¢n nh·∫Øc v·ªën";
    return "‚ùÑÔ∏è K√®o y·∫øu ‚Äì n√™n b·ªè qua";
}

/* ========= MAIN ========= */
function analyze() {
    const md5 = document.getElementById("md5").value.trim().toLowerCase();
    const out = document.getElementById("result");
    if (!/^[0-9a-f]{32}$/.test(md5)) {
        out.innerHTML = "‚ùå MD5 kh√¥ng h·ª£p l·ªá";
        return;
    }

    const entropy = hexEntropy(md5);
    const deep = deepScore(md5);
    const seed = parseInt(md5.slice(0,8),16);
    const total = 3 + seededRandom(seed)*15;
    const threshold = 10.5 + (entropy-4) + deep/100;
    const isLe = total >= threshold;

    const result = isLe ? "L·∫∫" : "CH·∫¥N";
    const icon = isLe ? "üî•" : "‚ùÑÔ∏è";
    const lot = pickLot(md5,isLe);

    const confidence = Math.min(95, Math.max(35, Math.round((entropy/4 + deep/100)*50)));

    out.innerHTML = `
        <h3>${icon} K·∫æT QU·∫¢</h3>
        <div class="highlight">${result}</div>
        <p><b>V·ªã l√≥t:</b> ${lot[0]} - ${lot[1]}</p>
        <p>üéØ T·ªâ l·ªá th·∫Øng: <b>${confidence}%</b></p>
        <p>üí° ${advice(confidence)}</p>
        <p class="small">Entropy: ${entropy.toFixed(3)} | Deep: ${deep.toFixed(1)}</p>
    `;

    saveHistory(md5, result, confidence);
    loadHistory();
}

/* ========= L·ªäCH S·ª¨ ========= */
function saveHistory(md5, res, conf) {
    let h = JSON.parse(localStorage.getItem("md5_history") || "[]");
    h.unshift({md5,res,conf});
    if (h.length > 10) h.pop();
    localStorage.setItem("md5_history", JSON.stringify(h));
}

function loadHistory() {
    let h = JSON.parse(localStorage.getItem("md5_history") || "[]");
    document.getElementById("historyList").innerHTML =
        h.map(i=>`<div class="history-item">${i.md5.slice(0,8)}‚Ä¶ ‚Üí ${i.res} (${i.conf}%)</div>`).join("");
}

loadHistory();

/* ========= D√ÅN ========= */
async function pasteMD5() {
    try {
        const text = await navigator.clipboard.readText();
        document.getElementById("md5").value = text.trim();
    } catch {
        alert("Kh√¥ng th·ªÉ d√°n");
    }
}
</script>
</body>
</html>
